/*! openvod | emma | ISC */

"use strict";!function(){angular.module("app.controllers",[]).controller("indexController",["$scope",function(a){var b=this;b.init=function(){this.maskUrl="",console.log("index"),b.showUpload=!1,b.uploadMaskUrl="pages/videoUpload.html",b.maskParams={}},b.showUploadHideMask=function(a){b.showUpload=a}}]).controller("loginController",["$scope","$http","$state","$filter","md5","util",function(a,b,c,d,e,f){console.log("loginController");var g=this;g.init=function(){console.log(e.createHash("dddd"))},g.login=function(){g.loading=!0;var a=JSON.stringify({username:g.userName,password:e.createHash(g.password)});b({method:"POST",url:f.getApiUrl("logon","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(f.setParams("token",b.token),f.setParams("account",g.userName),g.getEditLangs()):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.getEditLangs=function(){b({method:"GET",url:f.getApiUrl("","editLangs.json","local")}).then(function(a){f.setParams("editLangs",a.data.editLangs),c.go("app")},function(a){})}}]).controller("appController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){function g(){this.data=[],this.maxId=0}var h=this;h.init=function(){h.account=e.getParams("account"),h.showMaskClass=!1,"app"!==c.current.name?h.appPhase=2:h.appPhase=1,h.appFramePhase=1,h.maskUrl="",h.maskParams={},h.data={token:e.getParams("token"),user:h.account},e.setObject("ajaxData",h.data),h.loading=!0,a({method:"GET",url:e.getApiUrl("","apps.json","local")}).then(function(a,c,d,e){for(var f=a.data.apps,g=f.length,h=0;h<g;h++)f[h].nowPic=f[h].icon,f[h].choose=!1;b.appList=f},function(a,b,c,d){}).finally(function(a){h.loading=!1})},h.feedback=function(){b.app.showHideMask(!0,"pages/feedback.html")},h.setFocusApp=function(a){for(var c=b.appList,d=0;d<c.length;d++)if(c[d].id==a){h.activeAppName=c[d].name,h.activeAppIcon=c[d].icon_top,h.activeAppBgColor=c[d].bgColor,h.activeAppThemeColor=c[d].themeColor;break}},h.switchApp=function(a){switch(h.appPhase=2,h.appFramePhase=1,h.setFocusApp(a),a){case 1:c.includes("app.innerCut")||c.go("app.innerCut",{appId:a});break;case 2:c.includes("app.terminal")||c.go("app.terminal",{appId:a});break;case 3:c.includes("app.video")||c.go("app.video",{appId:a});break;case 4:c.includes("app.doctorAdvice")||c.go("app.doctorAdvice",{appId:a});break;case 5:c.includes("app.user")||c.go("app.user",{appId:a})}},h.showDesktop=function(){h.appPhase=1,setTimeout(function(){h.appFramePhase=1},530)},h.focusAppIcon=function(a,b){console.log(a),a.nowPic=a.icon_focus,a.choose=!0},h.blurAppIcon=function(a,b){a.nowPic=a.icon,a.choose=!1},h.focusLauncher=function(){h.appFramePhase=2},h.focusApp=function(){h.appFramePhase=1},h.logout=function(a){e.setParams("token",""),c.go("login")},h.showHideMask=function(a,b){a?(h.maskUrl=b,h.showMaskClass=!0):(h.maskUrl="",h.showMaskClass=!1)},h.uploadLists=function(){this.data=[],this.maxId=0},h.uploadLists.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=f.uploadImgUrl,g=new XMLHttpRequest,h={name:a.name,size:a.size,percentComplete:0,xhr:g},i=this.changeImg(h);e.uploadFileToUrl(g,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",i,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",i,d.upload_path,d.size)})},function(a){alert("图片上传失败，请重新上传"),c.deleteById(i),a.abort()})}},g.prototype={add:function(a,b){return this.data.push({video:a,subtitle:b,id:this.maxId}),this.maxId++},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].video.percentComplete<100&&"失败"!=b[c].video.percentComplete&&b[c].video.xhr.abort(),void 0!=b[c].subtitle.percentComplete&&b[c].subtitle.percentComplete<100&&"失败"!=b[c].subtitle.percentComplete&&b[c].subtitle.xhr.abort(),b.splice(c,1);break}},judgeCompleted:function(a,b){for(var c=this.data,d=0;d<c.length;d++)if(c[d].id==a){(c[d].video.percentComplete>=100&&void 0==c[d].subtitle.percentComplete||c[d].video.percentComplete>=100&&c[d].subtitle.percentComplete>=100)&&b.transcode(a,b);break}},transcode:function(b,d){for(var d=d,b=b,f=this.data,g={},h=0;h<f.length;h++)if(f[h].id==b){g=f[h];break}var i=JSON.stringify({action:"submitTranscodeTask",token:e.getParams("token"),rescode:"200",data:{movie:{oriFileName:g.video.name,filePath:g.video.src},subtitle:{oriFileName:g.subtitle.name,filePath:g.subtitle.src}}});console&&console.log(i),a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:i}).then(function(a){var e=a.data;"200"==e.rescode?(console&&console.log("转码 "+b),d.deleteById(b)):"401"==e.rescode?(alert("访问超时，请重新登录"),c.go("login")):(console&&console.log("转码申请失败后再次调用"),setTimeout(function(){d.transcode(b,d)},5e3))},function(a){console&&console.log("转码申请失败后再次调用"),console&&console.log(a),setTimeout(function(){d.transcode(b,d)},5e3)})},uploadFile:function(a,c,d){var g=f.uploadVideoUrl,h=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:h},j={};if(c){var k=new XMLHttpRequest;j={name:c.name,size:c.size,percentComplete:0,xhr:k}}var l=this.add(i,j);e.uploadFileToUrl(h,a,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("video",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("video",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("video",l,"失败")}),a.abort()}),void 0!=j.percentComplete&&e.uploadFileToUrl(j.xhr,c,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("subtitle",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("subtitle",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("subtitle",l,"失败")}),a.abort()})}}}]).controller("videoUploadController",["$http","$scope","$state","$stateParams","util","CONFIG","$filter","md5",function(a,b,c,d,e,f,g,h){function i(){this.data=[],this.maxId=0}var j=this;j.init=function(){j.editLangs=e.getParams("editLangs"),j.defaultLang=e.getDefaultLangCode(),j.uploadList=new i},j.cancel=function(){b.index.showUploadHideMask(!1)},j.add=function(){var a=b.index.maskParams.type;j.uploadList.uploadFile(b.myFileMovie,j.uploadList,a)},i.prototype={add:function(a){return this.data.push({video:a,id:this.maxId}),this.maxId++},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d,e,f){for(var g=0;g<this.data.length;g++)if(this.data[g].id==b){this.data[g][a].src=c,this.data[g][a].size=d,this.data[g][a].phu=e,this.data[g][a].pu=f;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].video.percentComplete<100&&"失败"!=b[c].video.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},judgeCompleted:function(a,b,c){for(var d=this.data,e=0;e<d.length;e++)if(d[e].id==a){d[e].video.percentComplete>=100&&b.transcode(a,b,c);break}},transcode:function(b,d,f){for(var g=this.data,h={},i=0;i<g.length;i++)if(g[i].id==b){h=g[i];break}var j=JSON.stringify({action:"submitTranscodeTask",token:e.getParams("token"),rescode:"200",data:{Type:f,movie:{oriFileName:h.video.name,filePath:h.video.src,PicURL:h.video.pu,PicURL_ABS:h.video.phu}}});console&&console.log(j),a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:j}).then(function(a){var e=a.data;"200"==e.rescode?(console&&console.log("转码 "+b),d.deleteById(b)):"401"==e.rescode?(alert("访问超时，请重新登录"),c.go("login")):(console&&console.log("转码申请失败后再次调用"),setTimeout(function(){d.transcode(b,d,f)},5e3))},function(a){console&&console.log("转码申请失败后再次调用"),console&&console.log(a),setTimeout(function(){d.transcode(b,d,f)},5e3)})},uploadFile:function(a,c,d){var g=f.uploadVideoUrl,h=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:h},j=this.add(i);e.uploadFileToUrl(h,a,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("video",j,b)}})},function(a){var e=JSON.parse(a.responseText);console&&console.log(e),b.$apply(function(){c.setSrcSizeById("video",j,e.filePath,e.size,e.thumbnail_http_path,e.thumbnail_path),c.judgeCompleted(j,c,d)})},function(a){b.$apply(function(){c.setPercentById("video",j,"失败")}),a.abort()})}}}]).controller("videoController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){function g(){this.data=[],this.maxId=0}var h=this;h.init=function(){h.uploadListUrl="",h.showUploadList=!1,h.gotoPage("app.video.transcodingList"),h.maskUrl="",h.maskParams={},h.uploadList=new g},h.gotoPage=function(a){switch(a){case"app.video.transcodingList":h.current=1;break;case"app.video.notEditedList":h.current=2;break;case"app.video.editedList":h.current=3}h.showUploadList=!1,c.go(a)},h.logout=function(a){e.setParams("token",""),c.go("login")},h.upload=function(){h.maskUrl="pages/addMovie.html"},g.prototype={add:function(a,b){return this.data.push({video:a,subtitle:b,id:this.maxId}),this.maxId++},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].video.percentComplete<100&&"失败"!=b[c].video.percentComplete&&b[c].video.xhr.abort(),void 0!=b[c].subtitle.percentComplete&&b[c].subtitle.percentComplete<100&&"失败"!=b[c].subtitle.percentComplete&&b[c].subtitle.xhr.abort(),b.splice(c,1);break}},judgeCompleted:function(a,b){for(var c=this.data,d=0;d<c.length;d++)if(c[d].id==a){(c[d].video.percentComplete>=100&&void 0==c[d].subtitle.percentComplete||c[d].video.percentComplete>=100&&c[d].subtitle.percentComplete>=100)&&b.transcode(a,b);break}},transcode:function(b,d){for(var d=d,b=b,f=this.data,g={},h=0;h<f.length;h++)if(f[h].id==b){g=f[h];break}var i=JSON.stringify({action:"submitTranscodeTask",token:e.getParams("token"),rescode:"200",data:{movie:{oriFileName:g.video.name,filePath:g.video.src},subtitle:{oriFileName:g.subtitle.name,filePath:g.subtitle.src}}});console&&console.log(i),a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:i}).then(function(a){var e=a.data;"200"==e.rescode?(console&&console.log("转码 "+b),d.deleteById(b)):"401"==e.rescode?(alert("访问超时，请重新登录"),c.go("login")):(console&&console.log("转码申请失败后再次调用"),setTimeout(function(){d.transcode(b,d)},5e3))},function(a){console&&console.log("转码申请失败后再次调用"),console&&console.log(a),setTimeout(function(){d.transcode(b,d)},5e3)})},uploadFile:function(a,c,d){var g=f.uploadVideoUrl,h=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:h},j={};if(c){var k=new XMLHttpRequest;j={name:c.name,size:c.size,percentComplete:0,xhr:k}}var l=this.add(i,j);e.uploadFileToUrl(h,a,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("video",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("video",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("video",l,"失败")}),a.abort()}),void 0!=j.percentComplete&&e.uploadFileToUrl(j.xhr,c,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("subtitle",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("subtitle",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("subtitle",l,"失败")}),a.abort()})}}}]).controller("transcodingListController",["$http","$scope","$state","$stateParams","util",function(a,b,c,d,e){console.log("transcodingListController");var f=this;f.init=function(){b.video.showUploadList=!1,f.getTranscodeTaskList(1)},f.getTranscodeTaskList=function(b){f.current=b,f.taskList=[],f.noData=!1,f.loading=!0;var d=JSON.stringify({token:e.getParams("token"),action:"getTranscodeTaskList",status:"working",Type:b});a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:d}).then(function(a){var b=a.data;if("200"==b.rescode){if(0==b.data.taskList.length)return void(f.noData=!0);f.taskList=b.data.taskList}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){f.loading=!1})},f.refresh=function(){f.getTranscodeTaskList(f.current)},f.upload=function(){b.index.showUploadHideMask(!0),b.index.maskParams={type:f.current}}}]).controller("notEditedListController",["$http","$scope","$state","$stateParams","util",function(a,b,c,d,e){console.log("notEditedListController");var f=this;f.init=function(){b.video.showUploadList=!1,f.current=e.getParams("currentVideoType"),f.current||(f.current=1),f.getTranscodeTaskList(f.current)},f.upload=function(){b.index.showUploadHideMask(!0),b.index.maskParams={type:f.current}},f.add=function(a){console.log(a),1==f.current?b.app.showHideMask(!0,"pages/addMovieInfo.html"):2==f.current&&b.app.showHideMask(!0,"pages/addVideoInfo.html"),b.app.maskParams=a},f.getTranscodeTaskList=function(b){f.current=b,f.loading=!0;var d=JSON.stringify({token:e.getParams("token"),action:"getTranscodeTaskList",status:"Completed",Type:b});a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(0==b.data.taskList.length&&(f.noData=!0),f.taskList=b.data.taskList):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){f.loading=!1})},f.delMovie=function(b){if(confirm("确定删除？")){var d=JSON.stringify({token:e.getParams("token"),action:"delTranscodeTask",lang:"zh-CN",taskID:b});a({method:"POST",url:e.getApiUrl("movie","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功"),f.getTranscodeTaskList(f.current)):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){})}}}]).controller("editedListController",["$http","$scope","$state","$filter","$stateParams","NgTableParams","util",function(a,b,c,d,e,f,g){console.log("editedListController");var h=this;h.init=function(){h.defaultLang=g.getDefaultLangCode(),b.arr={},b.arr.catrgoryArr=[],b.arr.LocationArr=[],h.getTags(),h.getSection(),h.getVideoLittelType()},h.upload=function(){b.index.showUploadHideMask(!0),b.index.maskParams={type:h.current}},h.edit=function(a){b.app.showHideMask(!0,"pages/editMovieInfo.html"),b.app.maskParams={movieID:a}},h.getTags=function(){var b=JSON.stringify({token:g.getParams("token"),action:"getTags"});a({method:"POST",url:g.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(0==b.CategoryList.length?h.noCategotyData=!0:h.categoryList=b.CategoryList,0==b.LocationList.length?h.noLocationData=!0:h.locationList=b.LocationList):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.chooseCateory=function(a,c){if(1==c)b.arr.catrgoryArr.push(a);else{var d=b.arr.catrgoryArr.indexOf(a);b.arr.catrgoryArr.splice(d,1)}},h.chooseLocation=function(a,c){if(1==c)b.arr.LocationArr.push(a);else{var d=b.arr.LocationArr.indexOf(a);b.arr.LocationArr.splice(d,1)}},b.$watch("arr",function(a){h.getMovieList(1)},!0),h.getMovieList=function(c){h.current=c,h.loading=!0,h.noData=!1,h.tableParams=new f({page:1,count:15,url:""},{counts:[],getData:function(c){var e={action:"getMovieList",token:g.getParams("token"),keywords:h.keywords,locationID:b.arr.LocationArr,categoryID:b.arr.catrgoryArr},f=c.url();return e.per_page=f.count-0,e.page=f.page-0,e=JSON.stringify(e),a({method:d("ajaxMethod")(),url:g.getApiUrl("movie","shopList","server"),data:e}).then(function(a,b,d,e){return 0==a.data.total&&(h.noData=!0),c.total(a.data.total),a.data.movieList},function(a,b,c,d){alert(response.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})},h.addMoreMovie=function(){b.app.showHideMask(!0,"pages/addMoreMovie.html")},h.delMovie=function(b){if(confirm("确定删除？")){var d=JSON.stringify({token:g.getParams("token"),action:"delMovie",lang:"zh-CN",movieID:b});a({method:"POST",url:g.getApiUrl("movie","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功"),c.reload(c.current.name)):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){})}},h.getSection=function(){h.section=[];var d=b.app.data;d.action="getHospitalInfo";var e=JSON.stringify(d);a({method:"POST",url:g.getApiUrl("hospital_info_original","","server1"),data:e}).then(function(a){var b=a.data;if("200"==b.rescode){h.section=b.data.Section,h.sectionOriginal=b.data.Section.concat();var d={Name:{"zh-CN":"全部"},ID:""};h.section.unshift(d),h.sectionName=h.section[0]}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.changeSection=function(){h.getVideos(2)},h.getVideoLittelType=function(b){var d=g.getObject("ajaxData");d.action="GetLittleTypeList";var e=JSON.stringify(d);a({method:"POST",url:g.getApiUrl("educationalvideo","","server"),data:e}).then(function(a){var d=a.data;if("200"==d.rescode){h.littleType=d.TypeList;var e={ID:"",Name:"全部"};h.littleType.unshift(e),b||(h.typeBtnChoose=h.littleType[0].ID)}else"401"==d.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(d.rescode+" "+d.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.getVideos=function(b){h.current=b,h.loading1=!0,h.noVideo=!1,h.tableParams=new f({page:1,count:10,url:""},{counts:[],getData:function(b){var c=b.url(),e={action:"GetVideoList",token:g.getParams("token"),keywords:h.searName?h.searName:"",pager:{total:-1,per_page:c.count-0,page:c.page-0,orderby:"",sortby:"desc"},SectionID:h.sectionName.ID,LittleTypeID:h.typeBtnChoose};return e=JSON.stringify(e),a({method:d("ajaxMethod")(),url:g.getApiUrl("educationalvideo","","server"),data:e}).then(function(a,c,d,e){var f=a.data.Pager,g=a.data.VideoList;if(0==f.total)return void(h.noVideo=!0);b.total(f.total);for(var i=0;i<g.length;i++)g[i].Name=JSON.parse(g[i].Name),g[i].SName=JSON.parse(g[i].SName),g[i].Lecturer=JSON.parse(g[i].Lecturer),g[i].Introduce=JSON.parse(g[i].Introduce);return console.log(g),g},function(a,b,c,d){alert(response.status+" 服务器出错")}).finally(function(a){h.loading1=!1})}})},h.addLiType=function(){h.maskUrl="pages/videoTypeAdd.html"},h.editLiType=function(){h.maskUrl="pages/videoTypeEdit.html"},h.delVideo=function(b){var d=g.getObject("ajaxData");d.action="DelVideo",d.VideoID=b;var e=JSON.stringify(d);a({method:"POST",url:g.getApiUrl("educationalvideo","","server"),data:e}).then(function(a){var b=a.data;"200"==b.rescode?alert("删除成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.getVideos(2)})},h.changeType=function(a){h.typeBtnChoose=a.ID,h.typeName=a.Name,h.getVideos(2)},h.delLiType=function(){if(confirm("确定删除该类型吗？")){var b=g.getObject("ajaxData");b.action="DelType",b.LittleTypeID=h.typeBtnChoose;var d=JSON.stringify(b);a({method:"POST",url:g.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功！"),h.getVideoLittelType()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}},h.editVideo=function(a){h.maskUrl="pages/editVideoInfo.html",console.log(a),h.video=a}}]).controller("addVideoTypeController",["$http","$scope","$state","$stateParams","util","CONFIG","$filter","md5",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){i.editLangs=e.getParams("editLangs"),i.defaultLang=e.getDefaultLangCode()},i.saveForm=function(){var b=e.getObject("ajaxData");b.action="AddType",b.Type={Name:i.name};var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功！"),i.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})},i.cancel=function(){b.editedList.maskUrl="",b.editedList.getVideoLittelType()}}]).controller("editVideoTypeController",["$http","$scope","$state","$stateParams","util","CONFIG","$filter","md5",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){i.editLangs=e.getParams("editLangs"),i.defaultLang=e.getDefaultLangCode(),i.id=b.editedList.typeBtnChoose,i.name=b.editedList.typeName},i.saveForm=function(){var b=e.getObject("ajaxData");b.action="UpdateTypeName",b.LittleTypeID=i.id,b.Type={Name:i.name};var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功！"),i.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})},i.cancel=function(){b.editedList.maskUrl="",b.editedList.getVideoLittelType(!0)}}]).controller("addMovieController",["$http","$scope","$state","$stateParams","util",function(a,b,c,d,e){console.log("addMovieController"),console.log(b.video.test);var f=this;f.init=function(){console.log(b.video.test)},f.cancel=function(){b.video.maskUrl=""},f.add=function(){b.video.uploadList.uploadFile(b.myFileMovie,b.myFileSubtitle,b.video.uploadList),b.video.maskUrl=""}}]).controller("addMovieInfoController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){function g(){this.data=[],this.maxId=0}console.log("addMovieInfoController");var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.maskParams=b.app.maskParams,h.catrgoryArr=[],h.LocationArr=[],h.movieInfo={},h.uploadList=new g,h.getTags()},h.cancel=function(){b.app.showHideMask(!1)},h.addCoverImg=function(){h.uploadList.uploadFile(b.myCoverImg,h.uploadList)},g.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=f.uploadImgUrl,g=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:g},j=this.changeImg(i);e.uploadFileToUrl(g,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",j,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",j,d.upload_path,d.size)}),h.movieInfo.PicSize=d.size,alert("图片上传成功")},function(a){alert("图片上传失败，请重新上传"),c.deleteById(j),a.abort()})}},h.getTags=function(){var b=JSON.stringify({token:e.getParams("token"),action:"getTags"});a({method:"POST",url:e.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(0==b.CategoryList.length?h.noCategotyData=!0:h.categoryList=b.CategoryList,0==b.LocationList.length?h.noLocationData=!0:h.locationList=b.LocationList):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.chooseCateory=function(a,b){if(1==b)h.catrgoryArr.push(a);else{var c=h.catrgoryArr.indexOf(a);h.catrgoryArr.splice(c,1)}},h.chooseLocation=function(a,b){if(1==b)h.LocationArr.push(a);else{var c=h.LocationArr.indexOf(a);h.LocationArr.splice(c,1)}},h.addMovie=function(){if(0==h.catrgoryArr.length)return void alert("请选择类型");if(0==h.LocationArr.length)return void alert("请选择产地");if(0==h.uploadList.data.length)return void alert("请上传图片");h.saving=!0;var b=JSON.stringify({token:e.getParams("token"),action:"addMovie",lang:"zh-CN",taskID:h.maskParams.ID,Movie:{Seq:h.movieInfo.Seq,PicSize:h.movieInfo.PicSize-0,Name:h.movieInfo.Name,Actor:h.movieInfo.Actor,Director:h.movieInfo.Director,URL_ABS:h.maskParams.URL,MovieSize:h.maskParams.Size,Duration:h.maskParams.Duration,Score:h.movieInfo.Score,SearchName:h.movieInfo.SearchName,Year:h.movieInfo.Year,Price:h.movieInfo.Price,Introduce:h.movieInfo.Introduce,PicURL_ABS:h.uploadList.data[0].img.src},Category:h.catrgoryArr,Location:h.LocationArr});a({method:"POST",url:e.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),h.cancel(),e.setParams("currentVideoType",1),c.reload("app.video.notEditedList")):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.saving=!1,h.cancel()})}}]).controller("addVideoInfoController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.videoInfoT=b.app.maskParams,g.videoInfo={},g.videoInfo.name={},g.videoInfo.name[g.defaultLang]=g.videoInfoT.FileOrigName,g.uploadList=new b.app.uploadLists,g.getSection(),g.getVideoLittelType()},g.cancel=function(){b.app.showHideMask(!1)},g.addCoverImg=function(){g.uploadList.uploadFile(b.myCoverImg,g.uploadList)},g.getSection=function(){g.section=[];var d=b.app.data;d.action="getHospitalInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:f}).then(function(a){var b=a.data;if("200"==b.rescode){g.section=b.data.Section;var d={Name:{"zh-CN":"未分区"},ID:void 0};g.section.unshift(d),g.sectionOne=g.section[0],console.log(g.section)}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.getVideoLittelType=function(){g.section=[];var b=e.getObject("ajaxData");b.action="GetLittleTypeList";var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(g.littleType=b.TypeList,g.littleType&&(g.liTypeOne=g.littleType[0])):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.addMovie=function(){g.saving=!0;var b=e.getObject("ajaxData");b.action="AddVideo",b.taskID=g.videoInfoT.ID,b.Video={LittleTypeID:g.liTypeOne.ID,SectionID:g.sectionOne.ID?g.sectionOne.ID:{},Name:g.videoInfo.name,Lecturer:g.videoInfo.Lecturer?g.videoInfo.Lecturer:{},URL_ABS:g.videoInfoT.URL,Duration:g.videoInfoT.Duration,VideoSize:g.videoInfoT.Size,Introduce:g.videoInfo.Introduce?g.videoInfo.Introduce:{},PicURL_ABS:g.videoInfoT.PicURL_ABS?g.videoInfoT.PicURL_ABS:""};var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),e.setParams("currentVideoType",2),c.reload("app.video.notEditedList")):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})}}]).controller("editVideoInfoController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.videoInfo=b.editedList.video,console.log(g.videoInfo),g.getSection(),g.getVideoLittelType()},g.cancel=function(){b.editedList.maskUrl="",b.editedList.getVideos(2)},g.getSection=function(){g.section=[];var d=b.app.data;d.action="getHospitalInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:f}).then(function(a){var b=a.data;if("200"==b.rescode){g.section=b.data.Section;var d={Name:{"zh-CN":"未分区"},ID:void 0};g.section.unshift(d);for(var e=g.section.length,f=0;f<e;f++)g.section[f].ID==g.videoInfo.SectionID&&(g.sectionOne=g.section[f])}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.getVideoLittelType=function(){g.section=[];var b=e.getObject("ajaxData");b.action="GetLittleTypeList";var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;if("200"==b.rescode){g.littleType=b.TypeList;for(var d=g.littleType.length,e=0;e<d;e++)g.littleType[e].ID==g.videoInfo.LittleTypeID&&(g.liTypeOne=g.littleType[e])}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.addMovie=function(){g.saving=!0;var b=e.getObject("ajaxData");b.action="UpdateVideo",b.VideoID=g.videoInfo.ID,b.Video={LittleTypeID:g.liTypeOne.ID,SectionID:g.sectionOne.ID,Name:g.videoInfo.Name,Lecturer:g.videoInfo.Lecturer,URL_ABS:g.videoInfo.URL,Duration:g.videoInfo.Duration,VideoSize:g.videoInfo.Size,Introduce:g.videoInfo.Introduce,PicURL_ABS:g.videoInfo.PicURL_ABS};var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("educationalvideo","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),e.setParams("currentVideoType",2),c.reload("app.video.notEditedList")):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})}}]).controller("addMoreMovieController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){function g(){this.data=[],this.maxId=0}console.log("addMoreMovieController");var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.catrgoryArr=[],h.LocationArr=[],h.movieInfo={},h.uploadList=new g,h.getTags()},h.cancel=function(){b.app.showHideMask(!1)},h.addCoverImg=function(){h.uploadList.uploadFile(b.myCoverImg,h.uploadList)},g.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},
setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=f.uploadImgUrl,g=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:g},j=this.changeImg(i);e.uploadFileToUrl(g,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",j,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",j,d.upload_path,d.size)}),h.movieInfo.PicSize=d.size,alert("图片上传成功")},function(a){alert("图片上传失败，请重新上传"),c.deleteById(j),a.abort()})}},h.getTags=function(){var b=JSON.stringify({token:e.getParams("token"),action:"getTags"});a({method:"POST",url:e.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(0==b.CategoryList.length?h.noCategotyData=!0:h.categoryList=b.CategoryList,0==b.LocationList.length?h.noLocationData=!0:h.locationList=b.LocationList):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.chooseCateory=function(a,b){if(1==b)h.catrgoryArr.push(a);else{var c=h.catrgoryArr.indexOf(a);h.catrgoryArr.splice(c,1)}},h.chooseLocation=function(a,b){if(1==b)h.LocationArr.push(a);else{var c=h.LocationArr.indexOf(a);h.LocationArr.splice(c,1)}},h.addMovie=function(){if(0==h.catrgoryArr.length)return void alert("请选择类型");if(0==h.LocationArr.length)return void alert("请选择产地");if(0==h.uploadList.data.length)return void alert("请上传图片");h.saving=!0;var b=JSON.stringify({token:e.getParams("token"),action:"addMovie",lang:"zh-CN",Movie:{Seq:h.movieInfo.Seq,PicSize:h.uploadList.data[0].img.size,Name:h.movieInfo.Name,Actor:h.movieInfo.Actor,Director:h.movieInfo.Director,URL_ABS:h.movieInfo.URL_ABS,MovieSize:h.movieInfo.MovieSize,Duration:h.movieInfo.Duration,Score:h.movieInfo.Score,SearchName:h.movieInfo.SearchName,Year:h.movieInfo.Year,Price:h.movieInfo.Price,Introduce:h.movieInfo.Introduce,PicURL_ABS:h.uploadList.data[0].img.src},Category:h.catrgoryArr,Location:h.LocationArr});a({method:"POST",url:e.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),h.cancel(),c.reload("app.video.notEditedList")):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.saving=!1,h.cancel()})}}]).controller("editMovieInfoController",["$http","$scope","$state","$filter","$stateParams","util","CONFIG",function(a,b,c,d,e,f,g){function h(){this.data=[],this.maxId=0}console.log("editMovieInfoController");var i=this;i.init=function(){i.editLangs=f.getParams("editLangs"),i.defaultLang=f.getDefaultLangCode(),i.maskParams=b.app.maskParams,i.catrgoryArr=[],i.LocationArr=[],i.movieInfo={},i.uploadList=new h,i.getMovieInfo()},i.cancel=function(){b.app.showHideMask(!1)},i.addCoverImg=function(){i.uploadList.uploadFile(b.myCoverImg,i.uploadList)},h.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=g.uploadImgUrl,e=new XMLHttpRequest,h={name:a.name,size:a.size,percentComplete:0,xhr:e},i=this.changeImg(h);f.uploadFileToUrl(e,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",i,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",i,d.upload_path,d.size)}),alert("图片上传成功")},function(a){alert("图片上传失败，请重新上传"),c.deleteById(i),a.abort()})}},i.getMovieInfo=function(){i.loading=!0;var b=JSON.stringify({token:f.getParams("token"),action:"getMovieInfoByID",movieID:i.maskParams.movieID});a({method:"POST",url:f.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;if("200"==b.rescode){i.movieInfo=b;var d={};d.img={},d.img.src=i.movieInfo.PicURL_ABS,d.img.size=i.movieInfo.PicSize,i.uploadList.data=[d],i.maskParams.URL_ABS=b.URL_ABS,i.maskParams.Duration=b.Duration}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.chooseCateory=function(a,b){if(1==b)i.catrgoryArr.push(a);else{var c=i.catrgoryArr.indexOf(a);i.catrgoryArr.splice(c,1)}},i.chooseLocation=function(a,b){if(1==b)i.LocationArr.push(a);else{var c=i.LocationArr.indexOf(a);i.LocationArr.splice(c,1)}},i.checkCategory=function(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return i.chooseCateory(a,!0),!0},i.checkLocation=function(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return i.chooseLocation(a,!0),!0},i.editMovieInfo=function(){i.saving=!0;var b=JSON.stringify({token:f.getParams("token"),action:"addMovie",lang:"zh-CN",movieID:i.maskParams.movieID,Movie:{Seq:i.movieInfo.Seq,Name:i.movieInfo.Name,PicSize:i.uploadList.data[0].img.size,Actor:i.movieInfo.Actor,Director:i.movieInfo.Director,URL_ABS:i.maskParams.URL_ABS,MovieSize:i.movieInfo.MovieSize,Duration:i.maskParams.Duration,Score:i.movieInfo.Score,SearchName:i.movieInfo.SearchName,Year:i.movieInfo.Year,Price:i.movieInfo.Price,Introduce:i.movieInfo.Introduce,PicURL_ABS:i.uploadList.data[0].img.src},Category:i.catrgoryArr,Location:i.LocationArr});a({method:"POST",url:f.getApiUrl("movie","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("编辑成功"),c.reload("app.video.editedList"),i.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})}}]).controller("musicLiarbryController",["$http","$scope","$state","$filter","$stateParams","NgTableParams","util",function(a,b,c,d,e,f,g){console.log("musicLiarbryController");var h=this;h.init=function(){h.defaultLang=g.getDefaultLangCode(),h.getMusicList()},h.getMusicList=function(){h.loading=!0;var b=JSON.stringify({token:g.getParams("token"),action:"getMusicList"});a({method:"POST",url:g.getApiUrl("music","","server"),data:b}).then(function(a){var b=a.data;if("200"==b.rescode){if(console.log(b.musicList),0==b.musicList.length)return void(h.noData=!0);h.musicList=b.musicList}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.delMusic=function(b){if(confirm("确定删除？")){var d=JSON.stringify({token:g.getParams("token"),action:"delMusic",lang:"zh-CN",ID:b,Item:"Music"});a({method:"POST",url:g.getApiUrl("music","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功"),c.reload(c.current.name)):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){})}},h.addMusic=function(){b.app.showHideMask(!0,"pages/addMusic.html")},h.editMusic=function(a){b.app.showHideMask(!0,"pages/editMusic.html"),b.app.maskParams={music:a}}}]).controller("addMusicController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){function g(){this.data=[],this.maxId=0}console.log("addMusicController");var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.maskParams=b.app.maskParams,h.movieInfo={},h.imgUploadList=new g,h.musicUploadList=new g},h.saveForm=function(){if(console.log(h.imgUploadList),console.log(h.musicUploadList),0==h.musicUploadList.data.length)return void alert("请上传音乐");if(0==h.imgUploadList.data.length)return void alert("请上传音乐图标");if(100!=h.imgUploadList.data[0].img.percentComplete||100!=h.musicUploadList.data[0].img.percentComplete)return void alert("上传中，请稍等");h.saving=!0;var b=JSON.stringify({token:e.getParams("token"),action:"addMusic",lang:"zh-CN",Music:{Seq:h.musicInfo.Seq,Name:h.musicInfo.Name,SingerName:h.musicInfo.SingerName,ColumnName:h.musicInfo.ColumnName,MusicIntro:h.musicInfo.MusicIntro,URL_ABS:h.musicUploadList.data[0].img.src,MusicSize:h.musicUploadList.data[0].img.size,PicURL_ABS:h.imgUploadList.data[0].img.src,PicSize:h.imgUploadList.data[0].img.size,Duration:h.musicInfo.Duration}});a({method:"POST",url:e.getApiUrl("music","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),h.cancel(),c.reload("app.video.musicLibrary",d,{reload:!0})):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.saving=!1,h.cancel()})},h.cancel=function(){b.app.showHideMask(!1)},h.addCoverImg=function(){if(!b.myCoverImg)return void alert("请先选择图标");h.imgUploadList.uploadFile(b.myCoverImg,h.imgUploadList)},h.addMusic=function(){if(!b.myMusic)return void alert("请先选择音乐");h.musicUploadList.uploadFile(b.myMusic,h.musicUploadList)},g.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=f.uploadImgUrl,g=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:g},j=this.changeImg(i);e.uploadFileToUrl(g,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",j,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",j,d.upload_path,d.size)}),h.movieInfo.PicSize=d.size},function(a){alert("图片上传失败，请重新上传"),c.deleteById(j),a.abort()})}}}]).controller("editMusicController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){function g(){this.data=[],this.maxId=0}console.log("editMusicController"),console.log(b.app.maskParams);var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.musicInfo=b.app.maskParams.music,h.imgUploadList=new g,h.musicUploadList=new g,h.imgUploadList.data=[{img:{src:h.musicInfo.PicURL_ABS,size:h.musicInfo.PicSize}}],h.musicUploadList.data=[{img:{src:h.musicInfo.URL_ABS,size:h.musicInfo.MusicSize}}]},h.saveForm=function(){if(0==h.musicUploadList.data.length)return void alert("请上传音乐");if(0==h.imgUploadList.data.length)return void alert("请上传音乐图标");h.saving=!0;var b=JSON.stringify({token:e.getParams("token"),action:"addMusic",musicID:h.musicInfo.musicID,lang:"zh-CN",Music:{Seq:h.musicInfo.Seq,Name:h.musicInfo.Name,SingerName:h.musicInfo.SingerName,ColumnName:h.musicInfo.ColumnName,MusicIntro:h.musicInfo.MusicIntro,URL_ABS:h.musicUploadList.data[0].img.src,MusicSize:h.musicUploadList.data[0].img.size,PicURL_ABS:h.imgUploadList.data[0].img.src,PicSize:h.imgUploadList.data[0].img.size,Duration:h.musicInfo.Duration}});a({method:"POST",url:e.getApiUrl("music","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),h.cancel(),c.reload("app.video.musicLibrary",d,{reload:!0})):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.saving=!1,h.cancel()})},h.cancel=function(){b.app.showHideMask(!1)},h.addCoverImg=function(){h.imgUploadList.uploadFile(b.myCoverImg,h.imgUploadList)},h.addMusic=function(){h.musicUploadList.uploadFile(b.myMusic,h.musicUploadList)},g.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=f.uploadImgUrl,g=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:g},j=this.changeImg(i);e.uploadFileToUrl(g,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",j,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",j,d.upload_path,d.size)}),h.movieInfo.PicSize=d.size,alert("上传成功")},function(a){alert("图片上传失败，请重新上传"),c.deleteById(j),a.abort()})}}}]).controller("userController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){console.log(b.app.data),g.userInfoUrl="",g.showUserInfo=!1,g.gotoPage("userInfo"),g.data=b.app.data,g.loading=!0,g.defaultLang=e.getDefaultLangCode(),g.current=0},g.gotoPage=function(a){"userInfo"==a?(g.current=0,g.getUserInfo(),""!==g.userInfoUrl||(g.userInfoUrl="pages/userInformation.html"),g.showUserInfo=!0):("app.user.section"==a?g.current=1:"app.user.version"==a&&(g.current=2),g.showUserInfo=!1,c.go(a))},g.getUserInfo=function(){var d=b.app.data;d.action="getUserInfoDetail",d.data={Account:e.getParams("account")};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?g.userInfo=b.data[0]:"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.edit=function(){b.app.showHideMask(!0,"pages/userInfoEdit.html"),b.app.maskParams={user:g.userInfo,section:g.chooseSection}},g.UploadLists=function(){this.data=[],this.maxId=0},g.UploadLists.prototype={add:function(a,b){return this.data.push({video:a,subtitle:b,id:this.maxId}),this.maxId++},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].video.percentComplete<100&&"失败"!=b[c].video.percentComplete&&b[c].video.xhr.abort(),void 0!=b[c].subtitle.percentComplete&&b[c].subtitle.percentComplete<100&&"失败"!=b[c].subtitle.percentComplete&&b[c].subtitle.xhr.abort(),b.splice(c,1);break}},judgeCompleted:function(a,b){for(var c=this.data,d=0;d<c.length;d++)if(c[d].id==a){(c[d].video.percentComplete>=100&&void 0==c[d].subtitle.percentComplete||c[d].video.percentComplete>=100&&c[d].subtitle.percentComplete>=100)&&b.transcode(a,b);break}},transcode:function(b,d){for(var d=d,b=b,f=this.data,g={},h=0;h<f.length;h++)if(f[h].id==b){g=f[h];break}var i=JSON.stringify({action:"submitTranscodeTask",token:e.getParams("token"),rescode:"200",data:{movie:{oriFileName:g.video.name,filePath:g.video.src},subtitle:{oriFileName:g.subtitle.name,filePath:g.subtitle.src}}});console&&console.log(i),a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:i}).then(function(a){var e=a.data;"200"==e.rescode?(console&&console.log("转码 "+b),d.deleteById(b)):"401"==e.rescode?(alert("访问超时，请重新登录"),c.go("login")):(console&&console.log("转码申请失败后再次调用"),setTimeout(function(){d.transcode(b,d)},5e3))},function(a){console&&console.log("转码申请失败后再次调用"),console&&console.log(a),setTimeout(function(){d.transcode(b,d)},5e3)})},uploadFile:function(a,c,d){var g=f.uploadVideoUrl,h=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:h},j={};if(c){var k=new XMLHttpRequest;j={name:c.name,size:c.size,percentComplete:0,xhr:k}}var l=this.add(i,j);e.uploadFileToUrl(h,a,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("video",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("video",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("video",l,"失败")}),a.abort()}),void 0!=j.percentComplete&&e.uploadFileToUrl(j.xhr,c,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("subtitle",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("subtitle",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("subtitle",l,"失败")}),a.abort()})}}}]).controller("editUserInfoController",["$http","$scope","$state","$stateParams","util","CONFIG","$filter","md5",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){i.editLangs=e.getParams("editLangs"),i.defaultLang=e.getDefaultLangCode(),i.user=b.app.maskParams.user,i.secName=i.user.SName[i.defaultLang],i.section=b.app.maskParams.section},i.saveForm=function(){if(!i.passwordBefore&&i.passwordAfter)return void alert("请输入原密码！");if(i.passwordBefore&&i.passwordAfter&&!i.passwordSure)return void alert("请确认新密码！");if(i.passwordBefore&&!i.passwordAfter&&i.passwordSure)return void alert("请输入新密码！");var d,f=void 0;i.passwordBefore&&(d=h.createHash(i.passwordBefore)),i.passwordAfter&&(f=h.createHash(i.passwordAfter));var g=b.app.data;g.action="UpdateUserInfo",g.data={Account:i.user.Account,Name:i.user.Name,OldPassword:d,Password:f,SectionID:i.user.sectionID};var j=JSON.stringify(g);a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:j}).then(function(a){var b=a.data;"200"==b.rescode?i.passwordAfter?(alert("保存成功,请重新登录！"),c.go("login")):(alert("保存成功！"),i.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})},i.testNewPwd=function(){i.passwordAfter&&i.passwordSure&&i.passwordAfter!=i.passwordSure&&alert("两遍新密码输入不同！")},i.cancel=function(){b.app.showHideMask(!1)}}]).controller("userAddController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){b.user.showUserInfo=!1,g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.getSection()},g.saveForm=function(){console.log(g.sectionId),g.secId="",g.sectionId&&(g.secId=g.sectionId.ID);var d=b.app.data;d.action="addUser",d.data={Name:g.name,Account:g.account,SectionID:g.secId};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.getSection=function(){g.section=[];var d=b.app.data;d.action="getHospitalInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:f}).then(function(a){var b=a.data;if("200"==b.rescode){g.section=b.data.Section;var d={Name:{"zh-CN":""},ID:void 0};g.section.unshift(d),g.sectionOne=g.section[0]}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("userManageController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){b.user.showUserInfo=!1,h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.sectionName="医院",h.getSection(),h.getUsers()},h.getUsers=function(c){h.noData=!1,h.loading=!0,h.tableParams=new g({page:1,count:10,url:""},{counts:[],getData:function(d){var f=b.app.data;f.action="getUserInfo";var g=d.url();f.data={SectionID:c,total:-1,per_page:g.count-0,page:g.page-0,orderby:"",sortby:"desc",keyword:"",status:""};var i=JSON.stringify(f);return a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:i}).then(function(a,b,c,e){if("200"==a.data.rescode)return 0==a.data.TotalCount?void(h.noData=!0):(d.total(a.data.TotalCount),h.users=a.data.data,a.data.data);"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})},h.getSection=function(){h.section=[];var d=b.app.data;d.action="getHospitalInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:f}).then(function(a){var b=a.data;if("200"==b.rescode){h.section=b.data.Section,h.sectionOriginal=b.data.Section.concat();var d={Name:{"zh-CN":"全部"},ID:void 0};h.section.unshift(d),h.sectionName=h.section[0]}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.changeSection=function(){console.log(h.sectionName),h.getUsers(h.sectionName.ID)},h.editUser=function(a){b.app.showHideMask(!0,"pages/userEdit.html"),b.app.maskParams={user:a,section:h.sectionOriginal}},h.resetPwd=function(d){var f=b.app.data;f.action="resettingPassword",f.data={ID:d};var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?alert("重置密码成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},h.delUser=function(d){var f=b.app.data;f.action="removeUser",f.data={ID:d};var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功"),c.reload()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}}]).controller("editUserController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.user=b.app.maskParams.user,g.section=b.app.maskParams.section;for(var a=0;a<g.section.length;a++)g.user.SectionID==g.section[a].ID&&(g.sectionName=g.section[a])},g.saveForm=function(){var f=b.app.data;f.action="editUser",f.data={ID:g.user.ID,Name:g.user.Name,SectionID:g.sectionName?g.sectionName.ID:void 0};var h=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("user_info_original","","server1"),data:h}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),g.cancel(),c.reload("app.user.section",d,{reload:!0})):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})},g.cancel=function(){b.app.showHideMask(!1),c.reload("app.user.list",d,{reload:!0})}}]).controller("hospitalManageController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.data=b.app.data,b.user.showUserInfo=!1,g.loading=!0,g.defaultLang=e.getDefaultLangCode(),g.showData(),g.chooseSection={}},g.showData=function(){g.data.action="getHospitalInfo";var b=JSON.stringify(g.data);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(g.hospitalData=b.data,console.log(g.hospitalData),0==g.hospitalData.Section.length&&(g.noData=!0)):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.editHospital=function(){b.app.showHideMask(!0,"pages/hospitalEdit.html"),b.app.maskParams={hospital:g.hospitalData}},g.addSection=function(){b.app.showHideMask(!0,"pages/sectionAdd.html"),b.app.maskParams={hospital:g.hospitalData}},g.editSction=function(a){b.app.showHideMask(!0,"pages/sectionEdit.html"),b.app.maskParams={hospital:g.hospitalData,section:a}},g.deleteSection=function(d){var f=b.app.data;f.action="removeSection",f.data={ID:d};var h=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:h}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功！"),g.showData(),c.go("app.user.section")):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.showSections=function(a){e.setObject("session",a),c.reload(),c.go("app.user.section.small",{id:a.ID})}}]).controller("editHospitalController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){console.log("editHospitalController");var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.hospital=b.app.maskParams.hospital,g.data=b.app.data},g.saveForm=function(){g.data.action="editHospital",g.data.data={ID:g.hospital.ID,Name:g.hospital.Name};var b=JSON.stringify(g.data);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})},g.cancel=function(){b.app.showHideMask(!1),c.reload("app.user.section",d,{reload:!0})}}]).controller("addSectionController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){console.log("addSectionController");var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.hospital=b.app.maskParams.hospital,g.data=b.app.data,g.uploadList=new b.app.uploadLists,g.uploadListHigh=new b.app.uploadLists,g.sectionName={}},g.saveForm=function(){if(0==g.uploadList.data.length)return void alert("请上传分区图标");if(0==g.uploadListHigh.data.length)return void alert("请上传分区高亮图标");if(100!=g.uploadList.data[0].img.percentComplete||100!=g.uploadListHigh.data[0].img.percentComplete)return void alert("上传中，请稍等");g.data.action="addSection",g.data.data={Name:g.sectionName,IconURL:g.uploadList.data[0].img.src,IconSize:g.uploadList.data[0].img.size,IconFocusURL:g.uploadListHigh.data[0].img.src,IconFocusSize:g.uploadListHigh.data[0].img.size,HospitalID:g.hospital.ID};var b=JSON.stringify(g.data);g.saving=!0,a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})},g.cancel=function(){b.app.showHideMask(!1),c.reload("app.user.section",d,{reload:!0})},g.addCoverImg=function(a,c){if(1==a){if(!b.myCoverImg)return void alert("请先选择图片");g.uploadList.uploadFile(b.myCoverImg,c)}else 2==a&&g.uploadListHigh.uploadFile(b.myCoverImgHigh,c)}}]).controller("editSectionController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){console.log("addSectionController");var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.hospital=b.app.maskParams.hospital,g.section=b.app.maskParams.section,g.data=b.app.data,g.uploadList=new b.app.uploadLists,g.uploadListHigh=new b.app.uploadLists,g.uploadList.data=[{img:{src:g.section.IconURL,size:g.section.IconSize}}],g.uploadListHigh.data=[{img:{src:g.section.IconFocusURL,size:g.section.IconFocusSize}}],g.sectionName=g.section.Name},g.saveForm=function(){if(0==g.uploadList.data.length)return void alert("请上传分区图标");if(0==g.uploadListHigh.data.length)return void alert("请上传分区高亮图标");if(100!=g.uploadList.data[0].img.percentComplete||100!=g.uploadListHigh.data[0].img.percentComplete)return void alert("上传中，请稍等");g.data.action="editSection",g.data.data={ID:g.section.ID,Name:g.sectionName,IconURL:g.uploadList.data[0].img.src,IconSize:g.uploadList.data[0].img.size,IconFocusURL:g.uploadListHigh.data[0].img.src,IconFocusSize:g.uploadListHigh.data[0].img.size,HospitalID:g.hospital.ID};var b=JSON.stringify(g.data);g.saving=!0,a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("修改成功"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})},g.cancel=function(){b.app.showHideMask(!1),c.reload("app.user.section",d,{reload:!0})},g.addCoverImg=function(a,c){if(1==a){if(!b.myCoverImg)return void alert("请先选择图片");g.uploadList.uploadFile(b.myCoverImg,c)}else 2==a&&g.uploadListHigh.uploadFile(b.myCoverImgHigh,c)}}]).controller("smallSectionController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){console.log("addSectionController");var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.chooseSection=e.getObject("session"),g.searchSmallSection()},g.searchSmallSection=function(){g.data1=b.app.data,g.data1.action="getLittleSectionByID",g.data1.data={ID:g.chooseSection.ID};var d=JSON.stringify(g.data1);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(g.smallSctions=b.data,g.smallSctions||(g.noSmall=!0)):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.addSmallSection=function(){b.app.showHideMask(!0,"pages/smallSectionAdd.html"),b.app.maskParams={section:g.chooseSection}},g.del=function(d){var f=b.app.data;f.action="removeLittleSection",f.data={ID:d};var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?(alert("删除成功！"),c.reload(c.current.name)):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){})},g.cancel=function(){b.app.showHideMask(!1),c.reload("app.user.section",d,{reload:!0})},g.addCoverImg=function(a,c){if(1==a){if(!b.myCoverImg)return void alert("请先选择图片");g.uploadList.uploadFile(b.myCoverImg,c)}else 2==a&&g.uploadListHigh.uploadFile(b.myCoverImgHigh,c)}}]).controller("addSmallSectionController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.section=b.app.maskParams.section,g.getSmallSectionAvil(),g.chooseIdNumber=0},g.getSmallSectionAvil=function(){g.loading=!0
;var d=b.app.data;d.action="getLittleSectionInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:f}).then(function(a){var b=a.data;if("200"==b.rescode){if(g.smallAvil=b.data,g.smallAvil)for(var d=0;d<g.smallAvil.length;d++)g.smallAvil[d].isChoosed=!1}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.changeSmallSecState=function(a){for(var b=0;b<g.smallAvil.length;b++)g.smallAvil[b].ID==a&&(g.smallAvil[b].isChoosed=!g.smallAvil[b].isChoosed,g.smallAvil[b].isChoosed?g.chooseIdNumber++:g.chooseIdNumber--)},g.save=function(){var d=[];if(g.smallAvil)for(var f=0;f<g.smallAvil.length;f++)1==g.smallAvil[f].isChoosed&&d.push(g.smallAvil[f].ID);var h=b.app.data;h.action="relateToSection",h.data={SectionID:g.section.ID,IDs:d};var i=JSON.stringify(h);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:i}).then(function(a){var b=a.data;"200"==b.rescode?(alert("修改成功！"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.cancel=function(){b.app.showHideMask(!1),c.reload("app.user.section",d,{reload:!0})}}]).controller("versionController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){b.user.showUserInfo=!1,g.loading=!0,g.defaultLang=e.getDefaultLangCode(),g.showData()},g.showData=function(){var d=b.app.data;d.action="getVersionInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("version_control","","server1"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?(g.version=b.data,g.version&&(0==g.version.local?g.localstate="更新中":g.localstate="更新完成",0==g.version.local?g.mgtstate="更新中":g.mgtstate="更新完成")):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.commit=function(){var d=b.app.data;d.action="submitVersion";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("version_control","","server1"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("提交成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("innerCutController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){function h(){this.data=[],this.maxId=0}var i=this;i.init=function(){i.resourceUrl="",i.showResource=!1,i.gotoPage("innerCutResource"),i.defaultLang=e.getDefaultLangCode(),i.maskUrl="",i.maskParams={},i.uploadList=new h,i.getSection(),i.getResBtn(),i.notEmpty=!1,i.page=1},i.gotoPage=function(a){"innerCutResource"==a?(i.current=0,""!==i.resourceUrl?i.getResBtn():i.resourceUrl="pages/innerCutResource.html",i.showResource=!0):(i.current=1,i.showResource=!1,c.go(a))},i.logout=function(a){e.setParams("token",""),c.go("login")},i.upload=function(){b.app.showHideMask(!0,"pages/addMovie.html")},i.getSection=function(){i.section=[];var d=b.app.data;d.action="getHospitalInfo";var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:f}).then(function(a){var b=a.data;if("200"==b.rescode){i.section=b.data.Section,i.sectionOriginal=b.data.Section.concat();var d={Name:{"zh-CN":"全部"},ID:-2};i.section.unshift(d),i.sectionName=i.section[0],i.getResource()}else"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.getResource=function(){i.noData=!1,i.loading=!0,i.tableParams=new g({page:i.page,count:8,url:""},{counts:[],getData:function(c){var d=b.app.data;d.action="GetPage",d.type=i.resourceChoose.ID,d.category=i.sectionName.ID;var f=c.url();d.pager={total:-1,per_page:f.count-0,page:f.page-0,orderby:"",sortby:"desc",keyword:i.resourceName?i.resourceName:"",status:""};var g=JSON.stringify(d);return i.page=f.page-0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:g}).then(function(a,b,d,e){if("200"==a.data.rescode){var f=a.data.Pager,g=a.data.Materials;if(0==f.total)return void(i.noData=!0);c.total(f.total);for(var h=0;h<g.length;h++)g[h].section=JSON.parse(g[h].section);return i.res=g,g}"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})}})},i.changeSection=function(){i.getResource()},i.getResBtn=function(){a({method:"GET",url:e.getApiUrl("","resourceButton.json","local")}).then(function(a,b,c,d){i.btns=a.data.resource,i.resourceChoose=i.btns[0]},function(a,b,c,d){}).finally(function(a){i.loading=!1})},i.addResource=function(a){switch(a){case 2:i.maskUrl="pages/innerCutResourcePicAdd.html";break;case 1:i.maskUrl="pages/innerCutResourceVideoAdd.html";break;case 3:i.maskUrl="pages/innerCutResourceLiveAdd.html";break;case 4:i.maskUrl="pages/innerCutResourceTextAdd.html"}i.resourceId=a},i.editResource=function(a){switch(i.resourceChoose.ID){case 2:i.maskUrl="pages/innerCutResourcePicEdit.html";break;case 1:i.maskUrl="pages/innerCutResourceVideoEdit.html";break;case 3:i.maskUrl="pages/innerCutResourceLiveEdit.html";break;case 4:i.maskUrl="pages/innerCutResourceTextEdit.html"}i.resource=a},i.delResource=function(){if(!i.checkboxes||!i.notEmpty)return void alert("请选择要删除的资源！");if(confirm("确定删除资源吗？")){i.ids=[];var b=i.checkboxes.items;for(var d in b)1==b[d]&&i.ids.push(d);var f=e.getObject("ajaxData");f.action="DelMaterial",f.type=i.resourceChoose.ID,f.ids=i.ids;var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("material","","server2"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?alert("删除成功!"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.getResource()})}},i.checkAll=function(){var a=i.res.length,b={};if(1==i.checkboxes.checked){for(var c=0;c<a;c++)b[i.res[c].id]=!0;i.checkboxes.items=b}else{for(var c=0;c<a;c++)b[i.res[c].id]=!1;i.checkboxes.items=b}i.changeCheckBox()},i.changeCheckBox=function(){var a=i.checkboxes;if(a){for(var b in a.items)if(1==a.items[b])return void(i.notEmpty=!0);i.notEmpty=!1}},i.changeResource=function(a){i.checkboxes=void 0,i.resourceChoose=a,i.getResource()},i.uploadLists=function(){this.data=[],this.maxId=0},i.uploadLists.prototype={add:function(a){return this.data.push({img:a,id:this.maxId}),this.maxId},changeImg:function(a){return this.data=[],this.data.push({img:a,id:this.maxId}),this.maxId},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].img.percentComplete<100&&"失败"!=b[c].img.percentComplete&&b[c].video.xhr.abort(),b.splice(c,1);break}},uploadFile:function(a,c){var d=f.uploadImgUrl,g=new XMLHttpRequest,h={name:a.name,size:a.size,percentComplete:0,xhr:g},i=this.changeImg(h);e.uploadFileToUrl(g,a,d,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.setPercentById("img",i,b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeById("img",i,d.upload_path,d.size)})},function(a){alert("图片上传失败，请重新上传"),c.deleteById(i),a.abort()})}},h.prototype={add:function(a,b){return this.data.push({video:a,subtitle:b,id:this.maxId}),this.maxId++},setPercentById:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].id==b){this.data[d][a].percentComplete=c;break}},setSrcSizeById:function(a,b,c,d){for(var e=0;e<this.data.length;e++)if(this.data[e].id==b){this.data[e][a].src=c,this.data[e][a].size=d;break}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].video.percentComplete<100&&"失败"!=b[c].video.percentComplete&&b[c].video.xhr.abort(),void 0!=b[c].subtitle.percentComplete&&b[c].subtitle.percentComplete<100&&"失败"!=b[c].subtitle.percentComplete&&b[c].subtitle.xhr.abort(),b.splice(c,1);break}},judgeCompleted:function(a,b){for(var c=this.data,d=0;d<c.length;d++)if(c[d].id==a){(c[d].video.percentComplete>=100&&void 0==c[d].subtitle.percentComplete||c[d].video.percentComplete>=100&&c[d].subtitle.percentComplete>=100)&&b.transcode(a,b);break}},transcode:function(b,d){for(var d=d,b=b,f=this.data,g={},h=0;h<f.length;h++)if(f[h].id==b){g=f[h];break}var i=JSON.stringify({action:"submitTranscodeTask",token:e.getParams("token"),rescode:"200",data:{movie:{oriFileName:g.video.name,filePath:g.video.src},subtitle:{oriFileName:g.subtitle.name,filePath:g.subtitle.src}}});console&&console.log(i),a({method:"POST",url:e.getApiUrl("tanscodetask","","server"),data:i}).then(function(a){var e=a.data;"200"==e.rescode?(console&&console.log("转码 "+b),d.deleteById(b)):"401"==e.rescode?(alert("访问超时，请重新登录"),c.go("login")):(console&&console.log("转码申请失败后再次调用"),setTimeout(function(){d.transcode(b,d)},5e3))},function(a){console&&console.log("转码申请失败后再次调用"),console&&console.log(a),setTimeout(function(){d.transcode(b,d)},5e3)})},uploadFile:function(a,c,d){var g=f.uploadVideoUrl,h=new XMLHttpRequest,i={name:a.name,size:a.size,percentComplete:0,xhr:h},j={};if(c){var k=new XMLHttpRequest;j={name:c.name,size:c.size,percentComplete:0,xhr:k}}var l=this.add(i,j);e.uploadFileToUrl(h,a,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("video",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("video",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("video",l,"失败")}),a.abort()}),void 0!=j.percentComplete&&e.uploadFileToUrl(j.xhr,c,g,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);d.setPercentById("subtitle",l,b)}})},function(a){var c=JSON.parse(a.responseText);console&&console.log(c),b.$apply(function(){d.setSrcSizeById("subtitle",l,c.filePath,c.size),d.judgeCompleted(l,d)})},function(a){b.$apply(function(){d.setPercentById("subtitle",l,"失败")}),a.abort()})}}}]).controller("addInnerCutPicController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){console.log("addSectionController");var g=this;g.init=function(){console.log(b.app.data),g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.uploadList=new b.cut.uploadLists,g.resId=b.cut.resourceId,g.section=b.cut.sectionOriginal,g.sectionName=g.section[0]},g.saveForm=function(){if(0==g.uploadList.data.length)return void alert("请上传图片");if(100!=g.uploadList.data[0].img.percentComplete)return void alert("上传中，请稍等");var b=e.getObject("ajaxData");b.action="AddMateril",b.data={name:g.PicName,path_abs:g.uploadList.data[0].img.src,size:g.uploadList.data[0].img.size,type:g.resId,category:g.sectionName.ID,md5:"",creator:e.getParams("account")};var d=JSON.stringify(b);g.saving=!0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功!"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1})},g.cancel=function(){b.cut.maskUrl="",b.cut.getResource()},g.addCoverImg=function(a){if(!b.myCoverImg)return void alert("请先选择图片");g.uploadList.uploadFile(b.myCoverImg,a)}}]).controller("editInnerCutPicController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){console.log("addSectionController");var g=this;g.init=function(){console.log(b.app.data),g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.source=b.cut.resource,g.type=b.cut.resourceChoose.ID;for(var a=b.cut.sectionOriginal,c=a.length,d=0;d<c;d++)a[d].ID==g.source.category&&(g.secName=a[d].Name)},g.saveForm=function(){var b=e.getObject("ajaxData");b.action="UpdateMaterial",b.type=g.type,b.data={name:g.source.name,id:g.source.id,content:""};var d=JSON.stringify(b);g.saving=!0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("修改成功!"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1})},g.cancel=function(){b.cut.maskUrl="",b.cut.getResource()}}]).controller("addInnerCutLiveController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode()},g.saveForm=function(){if(0==g.uploadList.data.length)return void alert("请上传图片");if(100!=g.uploadList.data[0].img.percentComplete)return void alert("上传中，请稍等");g.data.action="addSection",g.data.data={Name:g.sectionName,IconURL:g.uploadList.data[0].img.src,IconSize:g.uploadList.data[0].img.size,IconFocusURL:g.uploadListHigh.data[0].img.src,IconFocusSize:g.uploadListHigh.data[0].img.size,HospitalID:g.hospital.ID};var b=JSON.stringify(g.data);g.saving=!0,a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1,g.cancel()})},g.cancel=function(){b.app.showHideMask(!1)}}]).controller("addInnerCutTextController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.resId=b.cut.resourceId,g.section=b.cut.sectionOriginal,g.sectionName=g.section[0]},g.saveForm=function(){var b=e.getObject("ajaxData");b.action="AddMateril",b.data={name:g.name,path_abs:"",size:"",type:g.resId,category:g.sectionName.ID,md5:"",creator:e.getParams("account"),content:g.content};var d=JSON.stringify(b);g.saving=!0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功!"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1})},g.cancel=function(){b.cut.maskUrl="",b.cut.getResource()}}]).controller("editInnerCutTextController",["$http","$scope","$state","$stateParams","util","CONFIG",function(a,b,c,d,e,f){var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.defaultLang=e.getDefaultLangCode(),g.source=b.cut.resource,g.type=b.cut.resourceChoose.ID;for(var a=b.cut.sectionOriginal,c=a.length,d=0;d<c;d++)a[d].ID==g.source.category&&(g.secName=a[d].Name)},g.saveForm=function(){var b=e.getObject("ajaxData");b.action="UpdateMaterial",b.type=g.type,b.data={name:g.source.name,id:g.source.id,content:g.source.content};var d=JSON.stringify(b);g.saving=!0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(alert("修改成功!"),g.cancel()):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.saving=!1})},g.cancel=function(){b.cut.maskUrl="",b.cut.getResource()}}]).controller("innerCutPlanController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){b.cut.showResource=!1,h.defaultLang=e.getDefaultLangCode(),h.getResBtn(),h.page=1},h.getPlanList=function(){h.noData=!1,h.loading=!0,h.tableParams=new g({page:h.page,count:8,url:""},{counts:[],getData:function(b){var c=e.getObject("ajaxData");c.action="GetPlanList";var d=b.url();c.type=h.resourceChoose.ID,c.pager={total:-1,per_page:d.count-0,page:d.page-0,orderby:"",sortby:"desc",keyword:h.planName?h.planName:"",status:""};var f=JSON.stringify(c);return h.page=d.page-0,a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a,c,d,e){var f=a.data;if("200"==f.rescode){var g=f.Pager;return g.total&&0!=g.total?(h.res=f.Resource,b.total(g.total),h.res):void(h.noData=!0)}"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})},h.addPlan=function(a){switch(a){case 2:h.maskUrlPlan="pages/innerCutPlanPicAdd.html";break;case 1:h.maskUrlPlan="pages/innerCutPlanVideoAdd.html";break;case 3:h.maskUrlPlan="pages/innerCutPlanLiveAdd.html";break;case 4:h.maskUrlPlan="pages/innerCutPlanTextAdd.html"}},h.delPlan=function(){if(!h.checkboxes||!h.notEmpty)return void alert("请选择要删除的计划！");if(confirm("确定删除该计划吗？")){h.ids=[];var b=h.checkboxes.items;for(var d in b)1==b[d]&&h.ids.push({id:d});var f=e.getObject("ajaxData");f.action="DeletePlan",f.type=h.resourceChoose.ID,f.data={versions:h.ids};var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?alert("删除成功!"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.getPlanList()})}},h.delOnePlan=function(b){if(confirm("确定删除该计划吗？")){var d=e.getObject("ajaxData");d.action="DeletePlan",d.type=h.resourceChoose.ID,d.data={versions:[{id:b.version}]};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("删除成功!"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.getPlanList()})}},h.changeCheckBox=function(){var a=h.checkboxes;if(console.log(a),a){for(var b in a.items)if(1==a.items[b])return void(h.notEmpty=!0);h.notEmpty=!1}},h.editPlan=function(a){switch(h.resourceChoose.ID){case 2:h.maskUrlPlan="pages/innerCutPlanPicEdit.html";break;case 1:h.maskUrlPlan="pages/innerCutPlanVideoEdit.html";break;case 3:h.maskUrlPlan="pages/innerCutPlanLiveEdit.html";break;case 4:h.maskUrlPlan="pages/innerCutPlanTextEdit.html"}h.planItem=a},h.getResBtn=function(){a({method:"GET",url:e.getApiUrl("","resourceButton.json","local")}).then(function(a,b,c,d){h.btns=a.data.resource,h.resourceChoose=h.btns[0],h.getPlanList()},function(a,b,c,d){}).finally(function(a){h.loading=!1})},h.changeResource=function(a){h.resourceChoose=a,h.getPlanList()},h.checkAll=function(){var a=h.res.length,b={};if(1==h.checkboxes.checked){for(var c=0;c<a;c++)b[h.res[c].version]=!0;h.checkboxes.items=b}else{for(var c=0;c<a;c++)b[h.res[c].version]=!1;h.checkboxes.items=b}h.changeCheckBox()},h.publish=function(a){h.maskUrlPlan="pages/termPublish.html",h.plan=a},h.cancel=function(b){var d=e.getObject("ajaxData");d.action="CancelPlan",d.type=h.resourceChoose.ID,d.versions=b.version;var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功!"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.getPlanList()})}}]).controller("addPlanPicController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.page=0,h.getResourceList(),i()},h.saveForm=function(){if(h.stopTime-h.startTime<=0)return void alert("开始时间必须必须在结束时间之前！");var d=e.getObject("ajaxData");d.action="AddPlan",d.type=b.plan.resourceChoose.ID,d.data={name:h.planName,starttime:e.getRightTime(h.startTime),endtime:e.getRightTime(h.stopTime),id:h.resource};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("添加成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()},h.changePage=function(){if(h.page=h.page?0:1,h.page)for(var a=0;a<h.resourceList.length;a++)h.resourceList[a].id==h.resource&&(h.resChoosed=h.resourceList[a])},h.getResourceList=function(){h.noData=!1,h.loading=!0,h.tableParams=new g({page:1,count:5,url:""},{counts:[],getData:function(c){var d=e.getObject("ajaxData");d.action="GetPage",d.type=b.plan.resourceChoose.ID,d.category=-2;var f=c.url();d.pager={total:-1,per_page:f.count-0,page:f.page-0,orderby:"",sortby:"desc",keyword:"",status:""};var g=JSON.stringify(d);return a({method:"POST",url:e.getApiUrl("material","","server2"),data:g}).then(function(a,b,d,e){if("200"==a.data.rescode){var g=a.data.Pager,i=a.data.Materials;if(h.resourceList=i,0==g.total)return void(h.noData=!0);h.count=f.count-0,h.nowpage=f.page-0,c.total(g.total);for(var j=0;j<i.length;j++)i[j].section=JSON.parse(i[j].section),i[j].item=!0;return i}"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})};var i=function(){var a=new Date;h.startTime=e.setFormatTime(a);var b=a.getTime();b+=36e5;var c=new Date(b);h.stopTime=e.setFormatTime(c)}}]).controller("editPlanPicController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.planInfo=b.plan.planItem,h.planInfo.starttime=new Date(h.planInfo.starttime),h.planInfo.endtime=new Date(h.planInfo.endtime),console.log(h.planInfo)},h.saveForm=function(){if(h.planInfo.endtime-h.planInfo.starttime<=0)return void alert("开始时间必须必须在结束时间之前！");var d=e.getObject("ajaxData");d.action="UpdatePlan",d.type=b.plan.resourceChoose.ID,d.data={name:h.planInfo.name,starttime:e.getRightTime(h.planInfo.starttime),endtime:e.getRightTime(h.planInfo.endtime),version:h.planInfo.version};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()}}]).controller("addPlanVideoController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.page=0,h.getResourceList()},h.saveForm=function(){if(h.stopTime-h.startTime<=0)return void alert("开始时间必须必须在结束时间之前！");var d=e.getObject("ajaxData");d.action="AddPlan",d.type=b.plan.resourceChoose.ID,d.data={name:h.planName,starttime:e.getRightTime(h.startTime),endtime:e.getRightTime(h.stopTime),id:h.resource};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("添加成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()},h.changePage=function(){if(h.page=h.page?0:1,h.page)for(var a=0;a<h.resourceList.length;a++)h.resourceList[a].id==h.resource&&(h.resChoosed=h.resourceList[a])},h.getResourceList=function(){h.noData=!1,h.loading=!0,h.tableParams=new g({page:1,count:5,url:""},{counts:[],getData:function(c){var d=e.getObject("ajaxData");d.action="GetPage",d.type=b.plan.resourceChoose.ID,d.category=-2;var f=c.url();d.pager={total:-1,per_page:f.count-0,page:f.page-0,orderby:"",sortby:"desc",keyword:"",status:""};var g=JSON.stringify(d);return h.count=f.count-0,h.nowpage=f.page-0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:g}).then(function(a,b,d,e){if("200"==a.data.rescode){var f=a.data.Pager,g=a.data.Materials;if(h.resourceList=g,0==f.total)return void(h.noData=!0);c.total(f.total);for(var i=0;i<g.length;i++)g[i].section=JSON.parse(g[i].section);return g}"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})},h.chooseResource=function(){console.log(h.resource)},h.initTime=function(){var a=new Date;if(h.startTime=e.setFormatTime(a),h.resource){var b=h.resChoosed.duration;b||(b=3600);var c=a.getTime();c+=1e3*b;var d=new Date(c);h.stopTime=e.setFormatTime(d)}}}]).controller("editPlanVideoController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.planInfo=b.plan.planItem,h.planInfo.starttime=new Date(h.planInfo.starttime),h.planInfo.endtime=new Date(h.planInfo.endtime),console.log(h.planInfo)},h.saveForm=function(){if(h.planInfo.endtime-h.planInfo.starttime<=0)return void alert("开始时间必须必须在结束时间之前！");var d=e.getObject("ajaxData");d.action="UpdatePlan",d.type=b.plan.resourceChoose.ID,d.data={name:h.planInfo.name,starttime:e.getRightTime(h.planInfo.starttime),endtime:e.getRightTime(h.planInfo.endtime),version:h.planInfo.version};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()}}]).controller("addPlanLiveController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.page=0,h.getResourceList(),i()},h.saveForm=function(){if(h.stopTime-h.startTime<=0)return void alert("开始时间必须必须在结束时间之前！");var d=e.getObject("ajaxData");d.action="AddPlan",d.type=b.plan.resourceChoose.ID,d.data={name:h.planName,starttime:e.getRightTime(h.startTime),endtime:e.getRightTime(h.stopTime),id:h.resource};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("添加成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()},h.changePage=function(){if(h.page=h.page?0:1,h.page)for(var a=0;a<h.resourceList.length;a++)h.resourceList[a].id==h.resource&&(h.resChoosed=h.resourceList[a])},h.getResourceList=function(){h.noData=!1,h.loading=!0,h.tableParams=new g({page:1,count:5,url:""},{counts:[],getData:function(c){var d=e.getObject("ajaxData");d.action="GetPage",d.type=b.plan.resourceChoose.ID,d.category=-2;var f=c.url();d.pager={total:-1,per_page:f.count-0,page:f.page-0,orderby:"",sortby:"desc",keyword:"",status:""};var g=JSON.stringify(d);return h.count=f.count-0,h.nowpage=f.page-0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:g}).then(function(a,b,d,e){if("200"==a.data.rescode){var f=a.data.Pager,g=a.data.Materials;if(h.resourceList=g,0==f.total)return void(h.noData=!0);c.total(f.total);for(var i=0;i<g.length;i++)g[i].section=JSON.parse(g[i].section),g[i].item=!0;return g}"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})};var i=function(){var a=new Date;h.startTime=e.setFormatTime(a);var b=a.getTime();b+=36e5;var c=new Date(b);h.stopTime=e.setFormatTime(c)}}]).controller("editPlanLiveController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.planInfo=b.plan.planItem,h.planInfo.starttime=new Date(h.planInfo.starttime),h.planInfo.endtime=new Date(h.planInfo.endtime),console.log(h.planInfo)},h.saveForm=function(){var d=h.planInfo.endtime-h.planInfo.starttime;if(d<=0)return void alert("开始时间必须必须在结束时间之前！");console.log(d);var f=e.getObject("ajaxData");f.action="UpdatePlan",f.type=b.plan.resourceChoose.ID,f.data={name:h.planInfo.name,starttime:e.getRightTime(h.planInfo.starttime),endtime:e.getRightTime(h.planInfo.endtime),version:h.planInfo.version};var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()}}]).controller("addPlanTextController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),h.page=0,h.getResourceList(),i()},h.saveForm=function(){if(h.stopTime-h.startTime<=0)return void alert("开始时间必须必须在结束时间之前！");var d=e.getObject("ajaxData");d.action="AddPlan",d.type=b.plan.resourceChoose.ID,d.data={name:h.planName,starttime:e.getRightTime(h.startTime),endtime:e.getRightTime(h.stopTime),id:h.resource,content:h.resChoosed.content};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("添加成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()},h.changePage=function(){if(h.page=h.page?0:1,h.page)for(var a=0;a<h.resourceList.length;a++)h.resourceList[a].id==h.resource&&(h.resChoosed=h.resourceList[a])},h.getResourceList=function(){h.noData=!1,h.loading=!0,h.tableParams=new g({page:1,count:5,url:""},{counts:[],getData:function(c){var d=e.getObject("ajaxData");d.action="GetPage",d.type=b.plan.resourceChoose.ID,d.category=-2;var f=c.url();d.pager={total:-1,per_page:f.count-0,page:f.page-0,orderby:"",sortby:"desc",keyword:"",status:""};var g=JSON.stringify(d);return h.count=f.count-0,h.nowpage=f.page-0,a({method:"POST",url:e.getApiUrl("material","","server2"),data:g}).then(function(a,b,d,e){if("200"==a.data.rescode){var f=a.data.Pager,g=a.data.Materials;if(h.resourceList=g,0==f.total)return void(h.noData=!0);c.total(f.total);for(var i=0;i<g.length;i++)g[i].section=JSON.parse(g[i].section),g[i].item=!0;return g}"401"==a.tata.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errorInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})}})};var i=function(){var a=new Date;h.startTime=e.setFormatTime(a);var b=a.getTime();b+=36e5;var c=new Date(b);h.stopTime=e.setFormatTime(c)}}]).controller("editPlanTextController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),
h.defaultLang=e.getDefaultLangCode(),h.planInfo=b.plan.planItem,h.planInfo.starttime=new Date(h.planInfo.starttime),h.planInfo.endtime=new Date(h.planInfo.endtime),console.log(h.planInfo)},h.saveForm=function(){var d=h.planInfo.endtime-h.planInfo.starttime;if(d<=0)return void alert("开始时间必须必须在结束时间之前！");console.log(d);var f=e.getObject("ajaxData");f.action="UpdatePlan",f.type=b.plan.resourceChoose.ID,f.data={name:h.planInfo.name,starttime:e.getRightTime(h.planInfo.starttime),endtime:e.getRightTime(h.planInfo.endtime),version:h.planInfo.version};var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()}}]).controller("publishController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.editLangs=e.getParams("editLangs"),h.defaultLang=e.getDefaultLangCode(),b.defaultLang=h.defaultLang},h.save=function(){console.log(h.term);var d=e.getObject("ajaxData");d.action="PublishPlan",d.type=b.plan.resourceChoose.ID,d.version=b.plan.plan.version,d.data={terms:h.term};var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("intercutresource","","server2"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?alert("发布成功！"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1,h.cancel()})},h.cancel=function(){b.plan.maskUrlPlan="",b.plan.getPlanList()},b.getTermList=function(){b.term={};var d=[],f=e.getObject("ajaxData");f.action="getDevListBySection",f.ID=b.plan.plan.version,f.type=b.plan.resourceChoose.ID;var g=JSON.stringify(f);a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:g}).then(function(a){var e=a.data;if("200"==e.rescode){b.hospital=e.resultJson[0],b.sections=e.resultJson.slice(1),b.hosterm=b.hospital.Dev;var f=b.sections.length,g={};b.check={};for(var i=0;i<f;i++){b.sections[i].termChooseNum=0;var j=b.sections[i].SectionID,k=b.sections;b.term[j]=k[i].Dev;for(var l=b.term[j],m=l.length,n=0;n<m;n++)if(1==l[n].flag){var o=l[n].ID;g[o]=!0,b.check=g,b.sections[i].termChooseNum++}}for(var p in b.check)d.push(p);h.format(d),b.$emit("sectionState",b.sections)}else"401"==e.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(e.rescode+" "+e.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){h.loading=!1})},b.$on("conveyCheck",function(a,b){h.format(b),console.log("aaaaaaaa"+b)}),h.format=function(a){h.term=[];for(var b=a.length,c=0;c<b;c++){var d={};d.id=a[c],h.term[c]=d}}}]).controller("terminalController",["$http","$scope","$state","$stateParams","util","CONFIG","NgTableParams","$timeout",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){i.loading=!0,i.defaultLang=e.getDefaultLangCode(),i.getSection(),i.showSet=!1},i.getSection=function(){i.section=[];var b=e.getObject("ajaxData");b.action="getHospitalInfo";var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("hospital_info_original","","server1"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?(i.section=b.data.Section,i.current=i.section[0].ID):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1,i.getSectionDevList()})},i.getSectionDevList=function(){i.noData=!1,i.loading=!0,i.tableParams=new g({page:1,count:15,url:""},{counts:[],getData:function(b){var c=e.getObject("ajaxData");c.action="getDevList",c.Online=i.Online?i.Online:"",c.SectionID=i.current.toString(),c.RoomID=i.RoomID?i.RoomID:"";var d=b.url();c.per_page=d.count-0,c.page=d.page-0;var f=JSON.stringify(c);return a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:f}).then(function(a,c,d,e){if("200"==a.data.rescode){0==a.data.total&&(i.noData=!0),b.total(a.data.total),i.totalOnline=a.data.totalOnline,i.total=a.data.total;for(var f=a.data.DevInfo,g=f.length,h=0;h<g;h++)f[h].Name=JSON.parse(f[h].Name);return f}"401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})}})},i.getSectionDevNum=function(){i.getSectionDevList();var b={action:"getDevNum",token:e.getParams("token"),lang:i.langStyle,SectionID:i.current};b=JSON.stringify(b),a({method:$filter("ajaxMethod")(),url:e.getApiUrl("devinfo","","server"),data:b}).then(function(a,b,c,d){"200"==a.data.rescode?(i.form.total=a.data.total,i.form.online=a.data.online):"401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errInfo)},function(a,b,c,d){alert(response.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.delTerm=function(b){if(confirm("确认删除？")){var c=e.getObject("ajaxData");c.action="delDev",c.ID=b;var d=JSON.stringify(c);a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:d}).then(function(a,b,c,d){"200"==a.data.rescode?(alert("删除成功！"),i.getSectionDevList()):"401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")})}},i.validDev=function(b,f){var g={action:"validDev",token:e.getParams("token"),lang:i.langStyle,ID:[b]};g.status=f?0:1,g=JSON.stringify(g),a({method:$filter("ajaxMethod")(),url:e.getApiUrl("devinfo","","server"),data:g}).then(function(a,b,e,f){"200"==a.data.rescode?(alert("操作成功"),c.reload(c.current.name,d,!0)):"401"==a.data.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert("操作失败， "+a.data.errInfo)},function(a,b,c,d){alert("操作失败， "+a.data.errInfo)}).finally(function(a){})},i.changeSection=function(a){i.current=a,i.getSectionDevList()},i.set=function(a){i.showSet=!0,i.cover=a,i.getMaxVoice()},i.cancel=function(){i.showSet=!1},i.showDetail=function(a){i.showSet=!0,i.cover=3,i.ter=a},i.screenShot=function(b){i.shootfalse=!1,i.shooting=!0,i.screenShotPic="",i.showSet=!0,i.cover=2;var d=e.getObject("ajaxData");d.action="setSnapshotPic",d.ID=b;var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:f}).then(function(a){var d=a.data;"200"==d.rescode?h(function(){i.getScreenShot(b)},3e3):"401"==d.rescode?(alert("访问超时，请重新登录"),c.go("login")):(i.shootfalse=!0,i.shooting=!1)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.getScreenShot=function(b){i.shootfalse=!1;var d=e.getObject("ajaxData");d.action="showPicURL",d.ID=b;var f=JSON.stringify(d);a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?(i.screenShotPic=b.URL,i.shooting=!1):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):i.shootfalse=!0},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},b.$on("changePos",function(a,b){i.step=b}),i.getMaxVoice=function(){var b=e.getObject("ajaxData");b.action="showMaxVoice",b.SectionID=i.current;var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?i.step=b.MaxVoice:"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.setMaxVoice=function(){var b=e.getObject("ajaxData");b.action="setMaxVoice",b.SectionID=i.current,b.MaxVoice=i.step;var d=JSON.stringify(b);a({method:"POST",url:e.getApiUrl("hospitaldev","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?alert("修改成功!"):"401"==b.rescode?(alert("访问超时，请重新登录"),c.go("login")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})}}])}(),function(){angular.module("app.directives",[]).directive("fileModel",["$parse","CONFIG",function(a,b){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])}),"none"!=d.e&&document.getElementById(d.e).click()})}}}]).directive("stepper",function(a){return{restrict:"AE",template:'<style>.stepper-box{width:500px;height:10px;background:#f5f5f5;text-align:left;border-radius: 3px}.step-progress{float:left;height:10px;background:#198ad1;border-radius: 3px 0 0 3px}.step-progress ~ button{padding:10px 10px;margin-top:-5px;position:absolute; border-radius: 50%;border:none;margin-left: -3px;background:radial-gradient(#fff 0%, #198ad1 50%)}</style><div class="stepper-box"><div class="step-progress" ng-style="currentPos()"></div><button ng-click="currentPos()"><span></span></button></div>',controller:function(a){a.currentStep=0,a.maxStep=0,a.changePos=function(b){b>=0&&b<=a.maxStep&&b!==a.currentStep&&(a.currentStep=b,a.$emit("changePos",b))}},link:function(b,c,d){b.maxStep=d.maxstep||10;var e=c.children()[1].offsetWidth;d.$observe("currentstep",function(a){b.currentStep=a||10}),b.currentPos=function(a){return{width:100*b.currentStep/b.maxStep+"%"}},b.currentStep=2,c.on("click",function(a){if("button"!=a.target.nodeName.toLowerCase()){var c=a.offsetX||a.layerX;b.$apply(function(){b.changePos(Math.round(c/e*b.maxStep))})}});var f,g,h=c.find("button"),i=c.children().find("div");h.on("mousedown",function(d){g=!0,c.on("mousemove",function(a){if(g){var d=a.clientX-c[0].getBoundingClientRect().left,h=Math.round(d/e*b.maxStep);h>=0&&h<=b.maxStep&&(i.css("width",d+"px"),f=h)}}),a.on("mouseup",function(){g&&(b.changePos(f),b.$digest()),g=!1}),d.preventDefault()})}}}).directive("termList",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<ul ng-init="getTermList()"><li><input type="checkbox" ng-model="checkall" ng-change="checkHospital(this)"><span></span><h4>{{hospital.SectionName[defaultLang]}}</h4></div><ul ng-repeat="sec in sections"><li><input type="checkbox" ng-model="checksection[sec.SectionID]" ng-change="checkSection(sec, sec.SectionID)"><span></span><h4>{{sec.SectionName[defaultLang]}}</h4></div><ul><li ng-repeat="ter in term[sec.SectionID]"><input type="checkbox" ng-model="check[ter.ID]" ng-change="changeCheck(sec, ter)"><h4>{{ter.IP}}</h4></div></ul></ul></ul>',controller:function(a){a.conveyCheck=function(b){a.$emit("conveyCheck",b)}},link:function(a,b,c){a.changeCheck=function(b,c){a.checkbox=[];var e;for(var f in a.check)1==a.check[f]&&a.checkbox.push(f);if(a.conveyCheck(a.checkbox),b){for(var g=a.sections.length,h=0;h<g;h++)b.SectionID==a.sections[h].SectionID&&(e=h);var i=b.Dev.length;a.sections[e].termChooseNum=0;for(var j=0;j<i;j++)for(var k in a.check)b.Dev[j].ID==k&&(a.check[k]=!0)&&a.sections[e].termChooseNum++;d(a.sections)}},a.checkHospital=function(b){a.checksection={};var c=b.sections.length;if(1==b.checkall)for(var d=0;d<c;d++){var e=b.sections[d].SectionID;a.checksection[e]=!0,a.checkSection(b.sections[d],b.sections[d].SectionID)}else for(var f=0;f<c;f++){var g=b.sections[f].SectionID;a.checksection[g]=!1,a.checkSection(b.sections[f],b.sections[f].SectionID)}},a.checkSection=function(b,c){var d=a.term[c],e=d.length;if(a.checksection)for(var f in a.checksection)if(f==b.SectionID)if(a.checksection[f]){for(var g=0;g<e;g++){var h=d[g].ID;a.check[h]=!0}a.changeCheck()}else{for(var i=0;i<e;i++){var j=d[i].ID;a.check[j]=!1}a.changeCheck()}},a.$on("sectionState",function(a,b){d(b)});var d=function(b){a.checksection={},a.choosesection=0;for(var c=b.length,d=0;d<c;d++)if(b[d].termChooseNum==b[d].Dev.length&&0!=b[d].termChooseNum){var e=b[d].SectionID;a.checksection[e]=!0}for(var f in a.checksection)a.choosesection++;a.choosesection==c&&(a.checkall=!0)}}}}).directive("ngFocus",["$parse","CONFIG",function(a,b){return{restrict:"A",link:function(b,c,d){var e=a(d.ngFocus);e.assign}}}])}(),function(){angular.module("app.services",[]).factory("util",["$cookies","$translate","CONFIG","$window",function(a,b,c,d){return{getApiUrl:function(a,b,d){if(!d)return c.test?c.testUrl+b:c.serverUrl+a;switch(d){case"server":return c.serverUrlVideo+a;case"server1":return c.serverUrlOther+a;case"server2":return c.serverUrlCommon+a;default:return c.testUrl+b}},getUploadUrl:function(){return c.uploadUrl},setParams:function(b,c){a.put(b,JSON.stringify(c))},getParams:function(b){return!!a.get(b)&&JSON.parse(a.get(b))},setValue:function(a,b){d.localStorage[a]=b},getValue:function(a,b){return d.localStorage[a]||b},setObject:function(a,b){d.localStorage[a]=JSON.stringify(b)},getObject:function(a){return JSON.parse(d.localStorage[a]||"{}")},langStyle:function(){return b.proposedLanguage()||b.use()},getDefaultLangCode:function(){if(a.get("editLangs"))for(var b=JSON.parse(a.get("editLangs")),c=0;c<b.length;c++)if(b[c].default)return b[c].code},setFormatTime:function(a){function b(a){return a<10&&(a="0"+a),a}var c=a.getFullYear(),d=a.getMonth()+1,e=a.getDate(),f=a.getHours(),g=a.getMinutes()+2,h=a.getSeconds(),i=c+"-"+b(d)+"-"+b(e)+"T"+b(f)+":"+b(g)+":"+b(h);return new Date(i)},getRightTime:function(a){function b(a){return a<10&&(a="0"+a),a}var c=a.getFullYear(),d=a.getMonth()+1,e=a.getDate(),f=a.getHours(),g=a.getMinutes(),h=a.getSeconds();return c+"-"+b(d)+"-"+b(e)+"T"+b(f)+":"+b(g)+":"+b(h)},uploadFileToUrl:function(a,b,c,d,e,f,g){var d=d||"normal",h=new FormData;h.append("action",d),h.append("file",b),a.open("POST",c,!0),a.upload.addEventListener("progress",function(a){e(a)},!1),a.onreadystatechange=function(b){4==a.readyState&&200==a.status&&""!=a.responseText?(console.log(JSON.parse(a.responseText)),0!==JSON.parse(a.responseText).result?g(a):f(a)):200!=a.status&&a.responseText&&g(a)},a.send(h)}}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["CONFIG",function(a){return function(){return a.test?"GET":"POST"}}]).filter("fenToYuan",function(){return function(a){var b=a+"";return 1==b.length?b="00"+b:2==b.length&&(b="0"+b),b.slice(0,-2)+"."+b.slice(-2)}}).filter("subtitlePercentComplete",function(){return function(a){return a?"失败"==a?a:a+"%":"无"}}).filter("fileSize",function(){return function(a){return a>=1073741824?parseFloat(a/1073741824).toFixed(2)+"GB":a>=1048576?parseFloat(a/1048576).toFixed(2)+"MB":a>=1024?parseFloat(a/1024).toFixed(2)+"KB":a>=0?parseFloat(a).toFixed(2)+"B":void 0}}).filter("videoTime",function(){return function(a){var b="00",c="00",d="00",e=function(a){return a<10&&0!=a&&(a="0"+a),a};return a>=3600?(b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=a%3600%60):a>=60?(c=Math.floor(a/60),d=a%60):a>=0&&a&&(d=a),b=e(b),c=e(c),d=e(d),b+":"+c+":"+d}})}();